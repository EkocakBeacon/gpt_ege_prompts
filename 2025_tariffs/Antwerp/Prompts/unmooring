The vessel has the following particulars:
Name: {{{vessel.name}}}
LOA: {{{vessel.particulars.loa}}}
Beam: {{{vessel.particulars.boa}}}
GT: {{{vessel.particulars.grossTonnage}}}
Reduced GT: {{{vessel.particulars.reducedGrossTonnage}}}
Net Tonnage (NT): {{{vessel.particulars.netTonnage}}}
NRT: {{{vessel.nrt}}}
Summer Deadweight: {{{vessel.summerDwt}}}
Winter Deadweight: {{{vessel.winterDwt}}}
Length between perpendiculars: {{{vessel.particulars.lbp}}}
Type: {{{vessel.type}}}
ESI score: {{{vessel.esiScore}}}
Green Award score: {{{vessel.greenAward}}}

Port call data:
Draft in: {{{portCall.prospects.currentProspects.arrival.details.draftAft}}}
Draft out: {{{portCall.prospects.currentProspects.departureDraftAft}}}
Tugs in: {{{portCall.prospects.currentProspects.arrival.details.tugs}}}
Tugs out: {{{portCall.prospects.currentProspects.departure.details.tugs}}}
Cargoes:
{{#portCall.prospects.currentProspects.terminals}}
{{#cargoes}}
* {{cargo.operation.label}} {{cargo.quantity}} {{cargo.quantityMetricLabel}} of {{cargo.cargo.name}}
{{/cargoes}}
{{/portCall.prospects.currentProspects.terminals}}

Terminal names: 
{{#portCall.prospects.currentProspects.terminals}}
{{#terminal}}
*{{name}}
{{/terminal}}
{{/portCall.prospects.currentProspects.terminals}}

Local arrival time: {{{portCall.ata}}}
Local berthing time: {{{portCall.atb}}}
Local completion of cargo operation time: {{{portCall.atc}}}
Local departure time: {{{portCall.atd}}}

The amount that was invoiced to the vessel was: {{{line.currency}}} {{{line.localAmount}}}. It was for {{{line.line.name}}}.

The invoice image(s) are attached.  
Calculation instructions: {{{lineInstructions}}}

Antwerp Unmooring Fee
---------------------

Use the injected values above. Only consult the invoice when a value is missing; if still missing, capture it in brackets with units.
Return a numbered, human-readable breakdown and the final amount. If a billed amount exists, show the variance and Pass/Fail at ±2%.

Steps
1. Base by LOA ({{{vessel.particulars.loa}}} m):
   - Pick the row where LOA_m lies within [from, to] in UNMOORING_TARIFFS.
   - If LOA_m > 400: extra_segments = ceil((LOA_m-400)/5);
     Base += extra_segments × 109 (FRACTION_RATES["unmooring"]).
2. Time supplement (choose one):
   - Sunday → +50% of Base
   - Night (19:00–07:00) → +25% of Base
   - Otherwise 0
3. Location supplement: +30% of Base if Location contains "riverquay".
4. Delay supplement:
   - If DelayMinutes > 45:
       HoursDelayed = ceil((DelayMinutes-45)/60)
       DelaySuppl = (Base + TimeSuppl + LocSuppl) × 0.50 × HoursDelayed
   - Else 0
5. Reductions: −25% of Base if IsSecondCall
6. Cancellation fee: Base × 0.50 if IsCancelled else 0
7. Total = Base + TimeSuppl + LocSuppl + DelaySuppl + CancelFee − Reductions
8. Validate against invoice if provided.

UNMOORING_TARIFFS (EUR):
[
    (0, 80.00, 126),
    (80.01, 90.00, 151),
    (90.01, 100.00, 156),
    (100.01, 110.00, 210),
    (110.01, 120.00, 217),
    (120.01, 130.00, 247),
    (130.01, 138.00, 259),
    (138.01, 146.00, 276),
    (146.01, 152.00, 310),
    (152.01, 157.00, 355),
    (157.01, 160.00, 365),
    (160.01, 167.50, 388),
    (167.51, 175.00, 480),
    (175.01, 182.50, 529),
    (182.51, 190.00, 563),
    (190.01, 197.50, 589),
    (197.51, 205.00, 622),
    (205.01, 212.50, 637),
    (212.51, 220.00, 683),
    (220.01, 227.50, 717),
    (227.51, 235.00, 825),
    (235.01, 242.50, 920),
    (242.51, 250.00, 960),
    (250.01, 257.50, 991),
    (257.51, 265.00, 1033),
    (265.01, 272.50, 1072),
    (272.51, 280.00, 1102),
    (280.01, 287.50, 1139),
    (287.51, 295.00, 1216),
    (295.01, 302.50, 1402),
    (302.51, 310.00, 1468),
    (310.01, 317.50, 1604),
    (317.51, 325.00, 1746),
    (325.01, 330.00, 1960),
    (330.01, 335.00, 2177),
    (335.01, 340.00, 2393),
    (340.01, 345.00, 2502),
    (345.01, 350.00, 2586),
    (350.01, 355.00, 2609),
    (355.01, 360.00, 2722),
    (360.01, 365.00, 2831),
    (365.01, 370.00, 2940),
    (370.01, 375.00, 3048),
    (375.01, 380.00, 3157),
    (380.01, 385.00, 3266),
    (385.01, 390.00, 3373),
    (390.01, 395.00, 3481),
    (395.01, 400.00, 3588)
]
Fraction rate beyond 400m: 109 EUR per 5m.
